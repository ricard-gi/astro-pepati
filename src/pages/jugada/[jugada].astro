---

import Layout from "../../layouts/Layout.astro";

const {jugada} = Astro.params;

function getCurrentDate() {
    const date = new Date();
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
    const day = String(date.getDate()).padStart(2, '0');

    return `${year}-${month}-${day}`;
}



function jugadaRandom() {
    let opcions = ["PEDRA", "PAPER", "TISORA"];
    return opcions[Math.floor(Math.random() * opcions.length)];     
}

function guanyador(jugada1, jugada2) {
    if (jugada1 === jugada2) {
        return "Empatat";
    } else if (jugada1 === "PEDRA" && jugada2 === "TISORA") {
        return "Guanyador";
    } else if (jugada1 === "PAPER" && jugada2 === "PEDRA") {
        return "Guanyador";
    } else if (jugada1 === "TISORA" && jugada2 === "PAPER") {
        return "Guanyador";
    } else {
        return "Perdedor";
    }
}

function updateCookie(jugada, ordinador, resultat) {
    let cookie = Astro.cookies.get("pepati");
    let cookieData = JSON.parse(cookie.value);
    cookieData.push({data: getCurrentDate(), jugada, ordinador, resultat});
    Astro.cookies.set("pepati", JSON.stringify(cookieData), { path: '/' });
    //return Astro.redirect('/');
}

const jugadaOrdinador = jugadaRandom();

const resultat = guanyador(jugada, jugadaOrdinador);

updateCookie(jugada,jugadaOrdinador, resultat);

---

<Layout>

    <h1>Resultat de la jugada</h1>
    
    <h2>Jugada: {jugada}</h2>
    <h2>Jugada ordinador: {jugadaOrdinador}</h2>
    <h2>Resultat: {resultat}</h2>

    <br>
    <a href="/">Tornar</a>


</Layout>