---
import Layout from "../layouts/Layout.astro";

let gameData = []

if (!Astro.cookies.has("pepati")) {
  //const cookie = Astro.cookies.get("usuari")
  Astro.cookies.set("pepati", JSON.stringify([]), { path: '/' });

  return Astro.redirect('/')
} else {
	let cookie = Astro.cookies.get("pepati");
	gameData = JSON.parse(cookie.value);
	
}

let percentatgeGuanyador = 0;
if (gameData.length){
	percentatgeGuanyador = (gameData.filter(item => item.resultat === "Guanyador").length / gameData.length) * 100;	
}



---

<Layout>
	<h1>Tria la teva jugada</h1>

	<ul>
		<li><a href="/jugada/PEDRA">PEDRA</a></li>
		<li><a href="/jugada/PAPER">PAPER</a></li>
		<li><a href="/jugada/TISORA">TISORA</a></li>
	</ul>

	<hr>
	<h1>Jugades anteriors</h1>
	
	<a href="/neteja">Neteja historial</a>
	<br>
	<br>
	<table>
		<thead>
			<tr>
				<th>Data</th>
				<th>Jugada</th>
				<th>Ordinador</th>
				<th>Resultat</th>
		</thead>
		<tbody>
			{gameData.map((item, index) => (
				<tr>
					<td>{item.data}</td>
					<td>{item.jugada}</td>
					<td>{item.ordinador}</td>
					<td>{item.resultat}</td>
				</tr>
			))}
		</tbody>
	</table>
	{
		percentatgeGuanyador && (
			<p>Guanyador: {percentatgeGuanyador.toFixed(2)}%</p>
		)
	}
</Layout>
